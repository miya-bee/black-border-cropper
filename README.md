# Black Border Cropper (PNG/JPG/JPEG/PDF)

コピー機・スキャナーで取り込んだ画像/PDFの周囲に残る黒枠・余白を、自動でトリミングする Python 製 GUI ツールです。

- PNG / JPG / JPEG / PDF に対応
- フォルダ単位の一括処理に対応
- 自動判定 + 手動微調整（マウスドラッグ）
- 黒背景向けモード / 蓋なしスキャン（グレー背景）向けモード
- ページ回転、余白削除・追加、しきい値調整
- 再計算ボタン / 使い方ボタンを搭載
- （環境によって）ドラッグ＆ドロップ対応

---

## こんなときに便利

- 書籍や大学テキストをコピー・スキャンしたら、周囲に黒い影が残る
- PDF化したら見栄えが悪い / 無駄にサイズが大きい
- 全ページを手作業で切り抜くのがつらい

---

## 特徴

### 1. PDF / 画像をまとめて処理
PNG / JPG / JPEG / PDF を読み込み、フォルダ単位で一括処理できます。

### 2. 自動判定 + 手動調整
赤いクロップ枠を自動で出しつつ、必要ならプレビュー上でマウス操作で微調整できます。

### 3. 背景色モードを切り替え可能
- **黒**: 真っ黒背景でのスキャン向け
- **その他（フラットスキャナ蓋無）**: 蓋を開けたスキャンなど、グレーっぽい背景向け

### 4. 微調整機能
- 余白削除・追加（px）
- しきい値（または背景色許容差）調整
- 90度回転
- 表示倍率の変更（ズーム）
- 再計算ボタン（自動枠の再計算）
- 使い方ボタン（詳しい操作説明を表示）

---

## スキャン時のコツ（精度アップ）

このツールは、原稿と背景のコントラスト差を使って境界を推定します。  
そのため、**背景をできるだけ黒くする** と精度が上がりやすいです。

### フラットベッドスキャナー
蓋の裏に黒い紙を当てる（または貼る）と、余白が黒くなりやすくなります。

### コピー機 / 複合機
機種によっては蓋を少し浮かせると背景が暗くなることがあります。  
ただし機種差・安全面に注意してください（強い光を直視しない等）。

---

## 注意点（対応しにくいケース）

以下のようなケースでは自動判定がうまく決まらない場合があります。

- 背景が均一でない（木目・模様・反射・強い影）
- 原稿外周と背景の色が近い
- ページ端に黒ベタや写真がある
- 原稿の傾きが大きい
- 見開きのノド影が強い
- 内容が紙端ギリギリまである

改善策:
- 背景色モードを切り替える
- しきい値 / 背景色許容差を調整する
- 余白削除・追加(px)を調整する
- 手動で枠を微調整する
- 回転してから再判定する
- 数ページだけ試して設定を決めてから一括処理する

---

## 動作環境

- Python 3.10+（目安）
- GUI: tkinter（Python環境に含まれることが多い）
- Windows を主に想定（macOS / Linux でも動く可能性あり）

> Linux では `tkinter` が別パッケージ（`python3-tk` など）になる場合があります。

---

## インストール

### 推奨（PDF機能 + DnD を含む）

```bash
pip install numpy Pillow pymupdf tkinterdnd2
```

> ※ `tkinter` は通常、Windows版Pythonに同梱されています。  
> Linux では `python3-tk` などの追加インストールが必要な場合があります。

---

## 起動方法

```bash
python app.py
```

---

## 使い方（基本）

1. **ファイル選択** または **フォルダ選択**
2. プレビューの赤枠を確認
3. 必要に応じて以下を調整
   - 背景色モード
   - しきい値 / 背景色許容差
   - 余白削除・追加
   - 回転
4. 必要なら **再計算** ボタンで自動枠を再計算
5. 単件出力 or 一括処理を実行
6. 操作に迷ったら **使い方** ボタンで詳細説明を表示

---

## 出力ファイルについて

- 元ファイルを残したまま、クロップ済みファイルを別名で保存します
- 生成済みの `_crop` 系ファイルを再処理対象から外すための判定があります（再処理防止）

---

## スクリーンショット（任意）

<!-- 画像を追加したらコメントアウトを外してください -->
<!--
![Main UI](screenshots/main_ui.png)
![Preview & Manual Crop](screenshots/preview_manual_crop.png)
![Before / After](screenshots/before_after.png)
-->

---

## 既知の注意事項

- スキャナー/複合機の機種差により、背景の出方は大きく異なります
- 完全自動では難しいページもあるため、手動微調整機能を併用してください
- 著作権のある書籍・教材の扱いは、各利用規約・法令を確認の上で行ってください

---

## ライセンス

MIT License

---

## 免責

本ソフトウェアは現状有姿で提供されます。利用によって生じた損害について、作者は責任を負いません。
